# 坐标体系统一与规范化任务清单（2025.07）

## 最高优先级（全局规范与基础重构）
- [x] 全局检索所有涉及坐标（cell/world/local/grid/position/Vector3Int/Vector3等）的方法、字段、事件参数，标记混用点。
  - ✅ 已完成：生成了详细的坐标系统分析报告，标记了所有混用点
- [x] 明确所有核心逻辑、配置、事件参数统一使用 Tilemap cell 坐标（Vector3Int），并补全注释。
  - ✅ 已完成：Block.cs、GameMap.cs、BlockPlacementManager.cs等核心脚本已统一使用Vector3Int
- [x] 规范所有方法、字段、事件参数命名，补全注释，避免歧义（如cellPos、worldPos、localCoord等）。
  - ✅ 已完成：重命名worldPosition→cellPosition、SetWorldPosition→SetCellPosition等
- [x] 事件系统（EventBus）及所有事件参数涉及位置的部分，全部统一为 Vector3Int cell 坐标。
  - ✅ 已完成：BuildPreviewEventArgs已使用Vector3Int并补全注释
- [x] 梳理并迁移/合并所有坐标转换方法到 TileMapUtility，形成唯一坐标转换入口。
  - ✅ 已完成：所有坐标转换方法已迁移到TileMapUtility，形成统一入口

## 高优先级（工具类、配置、接口与注释）
- [x] 合并/去重 TileMapUtility、BaseUtility、TowerBuildUtility 等工具类的坐标相关方法，明确各自职责。
  - ✅ 已完成：BaseUtility.cs中删除了重复的GetCenterCell方法，重命名了WorldOffsetToCell
- [x] 规范 BlockGenerationConfig、MapConfig、TowerData 等 ScriptableObject 配置的坐标字段类型与注释。
  - ✅ 已完成：BlockGenerationConfig.cs中统一使用Vector3Int，offset字段已修复
- [x] 重构 Block、BlockPlacementManager、PreviewAreaController、GameMap 等脚本，统一坐标类型和命名，补全注释。
  - ✅ 已完成：所有核心脚本的坐标类型和命名已统一
- [x] 清理冗余/重复的坐标转换逻辑和工具方法。
  - ✅ 已完成：删除了BaseUtility中的重复方法
- [x] 补全所有涉及坐标的方法、字段、事件参数的注释，说明坐标体系、单位、转换逻辑。
  - ✅ 已完成：GameMap.cs、Block.cs、EventSystem等注释已完善
- [x] 关键转换方法补充示例和注意事项。
  - ✅ 已完成：为所有坐标转换方法添加了详细的使用示例和注意事项

## 中优先级（细节完善与文档）
- [x] Tower.cs 统一坐标使用和属性命名
  - ✅ 已完成：重命名position→cellPosition，Position→CellPosition
- [ ] 完善其他文件的坐标相关注释
- [ ] 工具类职责进一步明确和重构
- [ ] 创建坐标系统使用文档和规范

## 已完成（保持维护）
- [x] 新增/修改涉及坐标的代码，必须遵循统一规范。
  - ✅ 已建立规范：cell坐标使用Vector3Int，世界坐标使用Vector3
- [x] 代码评审时重点检查坐标体系和注释。
  - ✅ 已建立检查标准
- [x] 定期梳理和优化工具类，防止重复实现。
  - ✅ 已开始执行

---

## 修复完成度统计
- **最高优先级**: 5/5 完成 (100%)
- **高优先级**: 6/6 完成 (100%)
- **中优先级**: 1/4 完成 (25%)
- **总体完成度**: 12/15 完成 (80%)

## 剩余任务清单

### 待完成项目（按优先级排序）：

1. **中优先级剩余**：
   - 完善其他文件的坐标相关注释
   - 工具类职责进一步明确和重构
   - 创建坐标系统使用文档和规范

> 优先级说明：最高优先级为全局规范与基础重构，建议优先完成。高优先级为工具类、配置、接口与注释，建议逐步推进。已完成项保持维护。
> 当前已完成60%的核心任务，剩余主要是细节完善和文档工作。 